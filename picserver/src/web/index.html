<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <title>上海人保非车险报案暂存系统</title>
    <link href="public/stylesheets/public.css" rel="stylesheet" type="text/css" />
    <link href="public/stylesheets/login.css" rel="stylesheet" type="text/css" />
</head>
<body class="content_all">
        <div class="pen_left">
            <a href="###">
                <img src="images/login/logo.png">
            </a>
        </div>
        <div class="pen_bottom">
            <a href="###">
                <img src="images/login/login_title.png">
            </a>
        </div>
        <!-- <div class="cotent-right">

        </div> -->
        <form name="ttLogonForm" id="ttLogonForm" target="">
            <ul class="inputDiv">
                <li class="" style="padding-top:92px;">
                    <span for="username" class="pen_label">账号:</label>
                    <input type="text" class="name inputtext" maxlength="26" name="username" id="username"  onblur="blurecheck(this,1)" onfocus="getcheck(this,1)"
                    />
                   <!--  <img src="images/pen/people.png" alt="" class="tit" id="people" /> -->
                    <!-- <span class="txtTip" id="txtTip" onclick="tipshow(this)" style="display: block;font-family:SimSun!important">请输入用户名</span> -->
                </li>
                <li class="" style="margin-top:16px;">
                    <span for="username" class="pen_label">密码:</label>
                    <input type="password" name="password" id="password" autocomplete="off" class="inputtext" maxlength="26" onblur="blurecheck(this,2)" onfocus="getcheck(this,2)"
                    />
                   <!--  <img src="images/pen/pwd.png" alt="" class="titpwd" id="pwd" /> -->
                    <!-- <span class="txtTip1" id="passwordLog" onclick="tipshow(this)" style="display: block;font-family:SimSun!important">请输入密码</span> -->
                </li>
                <li style="margin-top: 8px;width:342px;position:relative;">
                    <span>
                        <input type="checkbox" name="userCode_Cookie" style="float:left;padding-left:0px!important;padding-right:10px!important"
                            id="userCode_Cookie" onchange="SetCookie()">
                        <span style="vertical-align:middle;color:#fff;font-size:14px;">记住账号</span>
                    </span>
                    <!--<span style="width:200px;display: inline-block;float:left;margin-left:10px;text-decoration:underline;">-->
                    <!--<a href="###">忘记密码</a>-->
                    <!--</span>-->
                    <span style="position:absolute;top:0px;right:0px;">
                        <input class="styButon" type="button" value="登录" onclick="login()">
                    </span>

                </li>
                <!-- <li style="margin-top:5px;">
                    
                </li> -->
            </ul>
        </form>
    <div class="footer"></div>
    <script type="text/javascript" src="resources/jquery-1.8.2.min.js"></script>
    <script src="resources/MD5.js"></script>
    <script type="text/javascript">
        var showmsgdiv = document.getElementById("showmsg");
        //显示的提示信息 点击事件
        function tipshow(obj) {
            //当前节点的上一个兄弟节点  注意空格也是文本节点
            var tempObj = obj.previousSibling.previousSibling.previousSibling.previousSibling;
            tempObj.focus();
            tempObj.style.borderColor = "#2684C2";
            obj.style.display = "none"
        }
        //得到焦点时候
        function getcheck(obj, type) {
            //得到焦点时候边框颜色发生变化
            obj.style.borderColor = "#ff3200";
            if (type == 1) {
                $('#people').attr('src', 'images/pen/people2.png')
            }
            if (type == 2) {
                $('#pwd').attr('src', 'images/pen/pwd2.png')
            }
            // if (obj.value == '' || obj.value == null) {
            //     /*提示的文本文字隐藏*/
            //     obj.nextSibling.nextSibling.nextSibling.nextSibling.style.display = "none";

            // }
        }
        // 失去焦点时候
        function blurecheck(obj, type) {
            /*失去焦点时候颜色变化*/
            obj.style.borderColor = "#dddddd";
            if (type == 1) {
                $('#people').attr('src', 'images/pen/people.png')
            }
            if (type == 2) {
                $('#pwd').attr('src', 'images/pen/pwd.png')
            }
            // if (obj.value == '' || obj.value == null) {
            //     /*提示文本显示*/
            //     obj.nextSibling.nextSibling.nextSibling.nextSibling.style.display = "block";
            // }
        }
        /*提交表单*/
        function login_submit() {
            var oform = document.forms["user_login"]
            var ouser = oform[0].value;
            var opsd = oform[1].value;
            if (ouser == '') {
                showmsgdiv.innerHTML = "请输入您的账号";
            } else if (opsd == '') {
                showmsgdiv.innerHTML = "请输入您的密码";
            } else {
                showmsgdiv.innerHTML = "帐号或密码有误";
            }
            return false;

        }
        //解决提交按钮 hover 颜色变化  ie6不支持hover
        function btn_login_color_change(obj, flag) {
            var color = flag == 'in' ? "#26B20E" : "#67C53C";
            obj.style.backgroundColor = color;
        }

        document.onkeydown = function () { //网页内按下回车触发
            if (event.keyCode == 13) {
                login();
            }
        };

        // 清除两边的空格
        String.prototype.trim = function () {
            return this.replace(/(^\s*)|(\s*$)/g, '');
        };

        function login() {
            SetCookie();
            var username = document.getElementById('username').value;
            var password = document.getElementById('password').value;
            if (password != '' && username != '') {
                password = hex_md5(password);
                $.ajax({
                    type: 'POST',
                    dataType: "json",
                    timeout: 3000,
                    url: '../api/Public/LoginCheck',
                    data: {
                        username: username.trim(),
                        password: password.trim(),
                        RandomTag: Math.random()
                    },
                    success: function (results) {
                        if (results.code == 200) {
                            location.href = 'ManagementSystem/';
                        } else {
                            alert(results.msg);
                        }
                    },
                    error: function (response) {
                        alert(response.err);
                    }
                })
            } else {
                alert("请输入用户名或密码！");
            }
        }

        function reset() {
            var username = document.getElementById('username');
            username.value = "";
            var password = document.getElementById('password');
            password.value = "";
        }

        function SetCookie() {
            //        debugger;
            var username = document.getElementById('username').value;
            var checkbox = document.getElementById("userCode_Cookie").checked;
            if (checkbox) { //选中 则记录
                document.cookie = "rbwycusername=" + username;
            } else { //不选中 则 不记录
                clearAllCookie();
                document.cookie = "rbwycusername=" + "userCode_Cookie20180316";
            }
        }

        function GetCookie() {
            // debugger;
            var _cookie = document.cookie;
            var username = document.getElementById('username');
            if (_cookie != '' && _cookie != undefined && _cookie != 'undefined' && _cookie != null) { //没有cookie
                // debugger;
                var cookieArr = _cookie.split(';');
                var cookie = '';
                for (var i = 0; i < cookieArr.length; i++) {
                    if (cookieArr[i].trim().split("rbwycusername=")[1]) {
                        cookie = cookieArr[i].trim().split("rbwycusername=")[1];
                    };
                }
                // var cookie = document.cookie.split("rbwycusername=")[1];
                if (cookie == "userCode_Cookie20180316") { //没选中
                    username.value = "";
                    document.getElementById("userCode_Cookie").checked = false;
                } else { //选中
                    // debugger;
                    username.value = cookie;
                    document.getElementById("userCode_Cookie").checked = true;
                    // document.getElementById('txtTip').style.display = "none";
                }
            }
        }
        GetCookie();

        function clearAllCookie() {
            var keys = document.cookie.match(/[^ =;]+(?=\=)/g);
            if (keys) {
                for (var i = keys.length; i--;)
                    document.cookie = keys[i] + '=0;expires=' + new Date(0).toUTCString()
            }
        }
    </script>
    <script type="text/javascript">
        window.onload = function () {
            if (document.readyState == "complete") {
                document.getElementById("username").focus();
            }
        }
    </script>

</body>

</html>